![](https://github.com/HemaxiN/3DArtificialVision/blob/main/images/icon3dav_final.png)

# 3DArtificialVision: A Deep Learning Tool for Analyzing 3D Mouse Retinal Vasculature in Microscopy Images

## ðŸŽ“ PhD Project  
**PhD Program:** Biomedical Engineering  
**Researcher:** Hemaxi Narotamo  

**This project was conducted at:** 
- Instituto Superior TÃ©cnico (IST) â€“ Instituto de Sistemas e RobÃ³tica (ISR)  
- Gulbenkian Institute for Molecular Medicine (GiMM)
- CatÃ³lica Biomedical Research Centre (CBR) 

**Supervisors:** Professor Margarida Silveira (IST,ISR) and Professor ClÃ¡udio Franco (GiMM and CBR)

## Abstract

Blood vessels supply oxygen and nutrients to tissues, and their dysfunction contributes to diseases such as retinopathies and cancer. Understanding the mechanisms involved in angiogenesis, the process of forming new blood vessels from pre-existing ones, is essential for identifying key components of disease progression and for creating new therapeutic approaches.

Studies in mouse retinas indicate that endothelial cells (ECs), which line the inner surface of blood vessels, polarize and migrate toward chemokines during vessel growth and against blood flow during vessel remodeling. EC polarity was computed as a vector between the nucleus and the Golgi complex centroids. These findings rely on 2D analysis neglecting the 3D vascular structure. Furthermore, previous studies required manual nucleus-Golgi vector annotation and semi-automatic vessel segmentation, which are laborious and expert-dependent tasks.

To overcome these limitations, we developed 3DArtificialVision, an automated framework composed of deep learning methods to compute nucleus-Golgi vectors and analyze blood vessels in 3D mouse retinal microscopy images. First, we present 3DCellPol, a convolutional neural network designed to detect and group nuclei and Golgi centroids. 3DCellPol outperforms previously proposed multi-stage methods while requiring much less training supervision, only 3D images and centroid pairs. Then, we demonstrate that training 3DCellPol using a combination of real data and synthetic data, generated by a generative adversarial network, improved its performance compared to using real data only.  The final part presents 3DArtificialVision, which segments 3D blood vessels using the cycleGAN model and quantifies vascular parameters such as vessel density, branch length, vessel radius, and branching point density. It efficiently segments vessels and detects phenotypes similar to those observed through manual analysis.

The 3DArtificialVision framework is presented as a free user-friendly graphical interface suitable for researchers without programming experience. This open-source tool will significantly improve the ability to study 3D vascular networks in both health and disease.

## Repositories with the Source Code

### Main Repositories

* [3DCellPol](https://github.com/HemaxiN/3DCellPol)
* [3DVascNet](https://github.com/HemaxiN/3DVascNet)
* [3DVectorAnnotationTool](https://github.com/HemaxiN/VectorAnnotationTool)
* [3DVox2Vox](https://github.com/HemaxiN/3DVox2Vox)
* [3DNGMic](https://github.com/HemaxiN/3DNGMic)

### Additional Repositories for Nucleus-Golgi Vector Prediction

* [3DYOLO](https://github.com/HemaxiN/3DYOLO)
* [3DU-Vec](https://github.com/HemaxiN/3D_U-Vec)


## Graphical User Interface

3DArtificialVision's user-friendly interface integrates [3DVascNet](https://github.com/HemaxiN/3DVascNet) and [3DCellPol](https://github.com/HemaxiN/3DCellPol).
The interface will soon be made publicly available [here](https://huggingface.co/Hemaxi/3DArtificialVision/tree/main).

![](https://github.com/HemaxiN/3DArtificialVision/blob/main/images/artificialvision.JPG)

## GPU Compatibility

Users need to install **CUDA 11.2** and **cuDNN 8.1**:

- [CUDA 11.2](https://developer.nvidia.com/cuda-11.2.0-download-archive)
- [cuDNN v8.1.0 (January 26th, 2021), for CUDA 11.0, 11.1, and 11.2](https://developer.nvidia.com/rdp/cudnn-archive)  [cuDNN Library for Windows (x86)]

### GPU Availability Check
At startup, the terminal will display either:

- **"GPU is available"**
- **"GPU is not available"**

If you have an NVIDIA GPU and see *"GPU is not available"*, feel free to contact me hemaxi.narotamo[at]tecnico.ulisboa.pt

### Monitoring GPU Usage
During segmentation, you can verify if the GPU is being utilized by running the `nvidia-smi` command in a terminal window.



## Instructions

### **1: Downloading and Launching the Application**

* Download the 3dartificialvision1.0.zip available [here](https://huggingface.co/Hemaxi/3DArtificialVision/tree/main) (It is currently available for Windows).
* Extract the files in your working directory, this will create a folder named 3dartificialvision with the application files.
* To start the application, double-click on the 3dartificialvision.exe file, two windows will open: a console that will display output and error messages, and the main GUI:

![](https://github.com/HemaxiN/3DArtificialVision/blob/main/images/console3dav.png)
![](https://github.com/HemaxiN/3DArtificialVision/blob/main/images/main_GUI.png)

### **2: Loading the Images**

* Click on the "Load Image(s)" button and select the directory containing the images that will be analyzed. Currently, our software supports .tif and .czi files, each image must have three-dimensions (X,Y,Z), and one channel representing the blood vessels. The images' names should have a prefix denoting its group (for instance 'GroupName_Image1.tif). This is important to later visualize the distributions of the vascular features  by grouping images belonging to the same group.
* Apart from the images, this directory should also contain a resolution.xlsx file with the information, for each image, about the voxel's physical size (in Âµm) along the x, y and z axes. Moreover, this file should contain two additional columns representing the image pre-processing parameters, perceqmin and perceqmax. Adjustment of these parameters is OPTIONAL, as we recommend using 1 and 99 for P6 retinas, and 0.5 and 99.5 for adult retinas. Even if the recommended parameters are used, they need to be defined in the resolution.xlsx file. Note: Please confirm if you should use dots (.) or commas (,) as decimal separator in this file, as misinterpretation can lead to incorrect data analysis and processing.

![](https://github.com/HemaxiN/3DVascNet/blob/main/images/files.PNG)
![](https://github.com/HemaxiN/3DVascNet/blob/main/images/resolutionfile.PNG)

3DArtificialVision will automatically read this file, or throw an error message if the file is not present in the selected directory.

* 3DArtificialVision will automatically create a results folder in the selected directory where all results will be saved:

![](https://github.com/HemaxiN/3DVascNet/blob/main/images/results.PNG)

* (OPTIONAL) To confirm that the images were properly loaded, use the horizontal slider to visualize different images, and the vertical slider to see each 2D slice across the depth dimension. Herein, we used two small images to explain the method, users can analyze entire retinas with our software:

![](https://github.com/HemaxiN/3DArtificialVision/blob/main/images/sliders.png)

### **3: Performing Segmentation**

* Click on the "Segment" button, this will perform segmentation of all the images based on the proposed 3D CycleGAN model. This step is computationally demanding, the segmentation time will highly depend on the number and size of the images and the specifications of the machine. It is recommended to use a machine with an Nvidia GPU. Output messages in the console will allow to monitor the segmentation process.
* The segmentation mask of each image will be saved in the results folder as a .tif file.
* The sliders can be used again to visualize the images and corresponding segmentation masks:

![](https://github.com/HemaxiN/3DArtificialVision/blob/main/images/sliders2.png)

### **4: Performing Quantification**

* (OPTIONAL) Select an image using the horizonal slider for which several ROIs need to be defined, then click on the "Select ROI" button, insert the names of the ROIs to be annotated. The names should be separated by commas and should not have spaces between them: 

![](https://github.com/HemaxiN/3DVascNet/blob/main/images/roi1.png)

Thereafter, manually select each ROI after clicking on the ROI name on the right. Using the left mouse button, add points to define the ROI for the selected region name: 

![](https://github.com/HemaxiN/3DVascNet/blob/main/images/roi2.PNG)

The region can be corrected clicking the right mouse button while placed on top of a previously defined point. After selecting the first ROI, click on another region name from the list on the right and add the points to define the ROI. When all ROIs are defined click on the "Done" button:

![](https://github.com/HemaxiN/3DVascNet/blob/main/images/roi3.PNG)
![](https://github.com/HemaxiN/3DVascNet/blob/main/images/roi4.PNG)

* Click on the "Quantify" button to perform 3D vasculature quantification. Output messages in the console will allow to monitor the quantification process. 3D skeletons will be automatically saved in the results folder, as .tif files with the "Skeleton_" prefix in their names. 
* Once finished, click on the "Save the Results" button, which will save a vessel_features.csv file in the results folder containing the computed features:

![](https://github.com/HemaxiN/3DVascNet/blob/main/images/vessel_features_csv.PNG)

A previously generated .csv file can be loaded at any time using the "Load CSV" button.

### **5: Computing Nucleus-Golgi Vectors**

Click on the "Quantify" button to compute the nucleus-Golgi vectors based on the red and green channels.

![](https://github.com/HemaxiN/3DArtificialVision/blob/main/images/vectors.png)

### **6: Comparison of Retinal Vasculature Features**

* Type the group names separated by commas and without spaces between them in the "Insert Group Names" box, for this simple example the following should be typed: Captopril,VEGF. Then select the features (Vessel Density, Branch Length, Branching Points and/or Vessel Radius), and click on the "Visualize Boxplots" button to compare retinal vasculature distributions for different groups.

![](https://github.com/HemaxiN/3DArtificialVision/blob/main/images/visualize_boxplots.png)

### **7: Visualizing polar histogram plots**

* Type the group names separated by commas and without spaces between them in the "Insert Group Names" box, for this simple example the following should be typed: Captopril,VEGF. Then select the feature "Polarity Angles", and click on the "Visualize Boxplots" button to visualize the polar histograms of the selected groups.

![](https://github.com/HemaxiN/3DArtificialVision/blob/main/images/visualize_polar_histogram.png)

### **8: Close the Application**

* To stop the application click on the "Quit" button or close the GUI window.
